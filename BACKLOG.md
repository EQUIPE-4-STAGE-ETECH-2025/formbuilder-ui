# üìã Backlog UI React - FormBuilder SaaS

## üéØ Vue d'ensemble

Ce backlog d√©taille toutes les t√¢ches n√©cessaires pour remplacer les donn√©es mock√©es par de vrais appels API dans l'application FormBuilder. Les t√¢ches sont organis√©es par priorit√© et modules fonctionnels.

---

## üöÄ Priorit√© 1 - Authentification et S√©curit√©

### 1.1 Service d'authentification

- [x] **AUTH-001** : Impl√©menter l'API de connexion (`POST /api/auth/login`)

  - Impl√©menter `authAPI.login()` dans `src/services/api/auth/authService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - G√©rer les tokens JWT c√¥t√© serveur
  - Impl√©menter la validation des identifiants avec Argon2
  - G√©rer les erreurs de connexion (identifiants invalides, compte suspendu)
  - Mettre √† jour `src/contexts/AuthProvider.tsx` pour utiliser le nouveau service

- [x] **AUTH-002** : Impl√©menter l'API d'inscription (`POST /api/auth/register`)

  - Impl√©menter `authAPI.register()` dans `src/services/api/auth/authService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Validation des donn√©es utilisateur (email unique, force du mot de passe)
  - Envoi d'email de v√©rification
  - Hachage du mot de passe avec Argon2
  - Mettre √† jour `src/pages/auth/Register.tsx` pour utiliser le nouveau service

- [x] **AUTH-003** : Impl√©menter l'API de v√©rification du profil (`GET /api/auth/me`)

  - Impl√©menter `authAPI.me()` dans `src/services/api/auth/authService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Validation du token JWT c√¥t√© serveur
  - Retour des informations utilisateur compl√®tes
  - Gestion de l'expiration du token
  - Mettre √† jour `src/contexts/AuthProvider.tsx` pour utiliser le nouveau service

- [x] **AUTH-004** : Impl√©menter la v√©rification d'email (`GET /api/auth/verify-email`)

  - Remplacer la logique mock√©e dans `src/pages/auth/EmailVerification.tsx`
  - Validation du token de v√©rification
  - Mise √† jour du statut `is_email_verified`
  - Gestion des erreurs de v√©rification

- [x] **AUTH-005** : Impl√©menter la r√©initialisation de mot de passe

  - Remplacer la logique mock√©e dans `src/pages/auth/ForgotPassword.tsx`
  - API de demande de r√©initialisation (`POST /api/auth/forgot-password`)
  - API de r√©initialisation avec token (`POST /api/auth/reset-password`)
  - Validation des tokens de r√©initialisation

- [x] **AUTH-006** : Impl√©menter la d√©connexion (`POST /api/auth/logout`)
  - Invalidation du token c√¥t√© serveur
  - Nettoyage c√¥t√© client
  - Redirection vers la page de connexion
  - Mettre √† jour `src/contexts/AuthProvider.tsx`

---

## üìä Priorit√© 2 - Gestion des Formulaires

### 2.1 Migration des services de formulaires

- [x] **FORMS-000** : Migrer les services de formulaires vers la nouvelle architecture
  - Impl√©menter `formsAPI` dans `src/services/api/forms/formsService.ts`
  - Impl√©menter `formVersionsAPI` dans `src/services/api/forms/versionsService.ts`
  - Cr√©er les types dans `src/services/api/forms/formsTypes.ts`
  - Mettre √† jour tous les imports dans les composants :
    - `src/pages/forms/FormsList.tsx`
    - `src/pages/forms/FormBuilder.tsx`
    - `src/pages/forms/FormEmbed.tsx`
    - `src/pages/forms/FormSubmissions.tsx`
    - `src/hooks/useForms.tsx`
    - `src/hooks/useFormHistory.tsx`
    - `src/hooks/useFormVersions.tsx`
    - `src/components/forms/FormHistory.tsx`
  - Tester que toutes les fonctionnalit√©s marchent encore
  - Valider que les types sont correctement export√©s

### 2.2 CRUD des formulaires

- [x] **FORMS-001** : Impl√©menter l'API de r√©cup√©ration des formulaires (`GET /api/forms`)

  - Migrer `formsAPI.getAll()` dans `src/services/api/forms/formsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Pagination et filtres (statut, date)
  - Tri par date de cr√©ation/modification
  - Gestion des permissions utilisateur
  - Mettre √† jour `src/hooks/useForms.tsx` pour utiliser le nouveau service

- [x] **FORMS-002** : Impl√©menter l'API de r√©cup√©ration d'un formulaire (`GET /api/forms/:id`)

  - Migrer `formsAPI.getById()` dans `src/services/api/forms/formsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Validation des permissions (propri√©taire ou admin)
  - R√©cup√©ration des champs et param√®tres
  - Mettre √† jour `src/pages/forms/FormBuilder.tsx` pour utiliser le nouveau service

- [x] **FORMS-003** : Impl√©menter l'API de cr√©ation de formulaire (`POST /api/forms`)

  - Migrer `formsAPI.create()` dans `src/services/api/forms/formsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Validation des donn√©es (titre, description)
  - Attribution automatique √† l'utilisateur connect√©
  - Cr√©ation de la premi√®re version
  - Mettre √† jour `src/pages/forms/FormBuilder.tsx` pour utiliser le nouveau service

- [x] **FORMS-004** : Impl√©menter l'API de mise √† jour de formulaire (`PUT /api/forms/:id`)

  - Migrer `formsAPI.update()` dans `src/services/api/forms/formsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Validation des permissions
  - Mise √† jour de `updated_at`
  - Gestion des champs modifi√©s
  - Mettre √† jour `src/pages/forms/FormBuilder.tsx` pour utiliser le nouveau service

- [x] **FORMS-005** : Impl√©menter l'API de suppression de formulaire (`DELETE /api/forms/:id`)
  - Migrer `formsAPI.delete()` dans `src/services/api/forms/formsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Suppression en cascade (versions, soumissions)
  - Validation des permissions
  - Soft delete optionnel
  - Mettre √† jour `src/pages/forms/FormsList.tsx` pour utiliser le nouveau service

### 2.3 Versions de formulaires

- [x] **VERSIONS-001** : Impl√©menter l'API de r√©cup√©ration des versions (`GET /api/forms/:id/versions`)

  - Migrer `formVersionsAPI.getByFormId()` dans `src/services/api/forms/versionsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Tri par num√©ro de version d√©croissant
  - Limitation √† 10 versions maximum
  - Mettre √† jour `src/hooks/useFormVersions.tsx` pour utiliser le nouveau service

- [x] **VERSIONS-002** : Impl√©menter l'API de cr√©ation de version (`POST /api/forms/:id/versions`)

  - Remplacer `formVersionsAPI.create()` dans `src/services/api/forms/versionsService.ts`
  - Validation du sch√©ma de formulaire
  - Incr√©mentation automatique du num√©ro de version
  - Sauvegarde compl√®te du formulaire
  - Mettre √† jour `src/hooks/useFormHistory.tsx` pour utiliser le nouveau service

- [x] **VERSIONS-003** : Impl√©menter l'API de restauration de version (`POST /api/forms/:id/versions/:version/restore`)

  - Remplacer `formVersionsAPI.restore()` dans `src/services/api/forms/versionsService.ts`
  - Cr√©ation d'une nouvelle version bas√©e sur l'ancienne
  - Mise √† jour du formulaire principal
  - Mettre √† jour `src/components/forms/FormHistory.tsx` pour utiliser le nouveau service

- [x] **VERSIONS-004** : Impl√©menter l'API de suppression de version (`DELETE /api/forms/:id/versions/:version`)
  - Remplacer `formVersionsAPI.delete()` dans `src/services/api/forms/versionsService.ts`
  - Validation (pas de suppression de la version active)
  - Mise √† jour des r√©f√©rences
  - Mettre √† jour `src/components/forms/FormHistory.tsx` pour utiliser le nouveau service

### 2.4 Publication et int√©gration

- [x] **FORMS-006** : Impl√©menter l'API de publication (`POST /api/forms/:id/publish`)

  - Changement de statut vers "PUBLISHED"
  - G√©n√©ration du token JWT pour l'iframe
  - Mise √† jour de `published_at`
  - Mettre √† jour `src/pages/forms/FormBuilder.tsx` pour utiliser le nouveau service

- [x] **FORMS-007** : Impl√©menter l'API de g√©n√©ration du code iframe (`GET /api/public/forms/:id/embed`)
  - G√©n√©ration du code HTML avec token JWT
  - Param√®tres de personnalisation (couleurs, messages)
  - Validation des permissions
  - Mettre √† jour `src/pages/forms/FormEmbed.tsx` pour utiliser le nouveau service

---

## üìù Priorit√© 3 - Gestion des Soumissions

### 3.1 Migration des services de soumissions

- [x] **SUBMISSIONS-000** : Migrer les services de soumissions vers la nouvelle architecture
  - Impl√©menter `submissionsAPI` dans `src/services/api/submissions/submissionsService.ts`
  - Cr√©er les types dans `src/services/api/submissions/submissionsTypes.ts`
  - Mettre √† jour tous les imports dans les composants :
    - `src/pages/forms/FormSubmissions.tsx`
  - Tester que toutes les fonctionnalit√©s marchent encore
  - Valider que les types sont correctement export√©s

### 3.2 Collecte des soumissions

- [x] **SUBMISSIONS-001** : Impl√©menter l'API de soumission (`POST /api/forms/:id/submit`)

  - Validation des donn√©es selon le sch√©ma du formulaire
  - V√©rification des quotas utilisateur
  - Enregistrement de l'IP et timestamp
  - Notifications email si configur√©es

- [x] **SUBMISSIONS-002** : Impl√©menter l'API de r√©cup√©ration des soumissions (`GET /api/forms/:id/submissions`)
  - Migrer `submissionsAPI.getByFormId()` dans `src/services/api/submissions/submissionsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Pagination et filtres (date, statut)
  - Tri par date de soumission
  - Validation des permissions
  - Mettre √† jour `src/pages/forms/FormSubmissions.tsx` pour utiliser le nouveau service

### 3.3 Export et analyse

- [x] **SUBMISSIONS-003** : Impl√©menter l'API d'export CSV (`GET /api/forms/:id/submissions/export`)

  - Migrer `submissionsAPI.exportCsv()` dans `src/services/api/submissions/submissionsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - G√©n√©ration du fichier CSV avec en-t√™tes
  - Gestion des caract√®res sp√©ciaux
  - T√©l√©chargement s√©curis√©
  - Mettre √† jour `src/pages/forms/FormSubmissions.tsx` pour utiliser le nouveau service

- [x] **SUBMISSIONS-004** : Impl√©menter les statistiques de soumissions
  - Nombre de soumissions par p√©riode
  - Taux de conversion
  - Temps moyen de remplissage

---

## üí≥ Priorit√© 4 - Gestion des Abonnements et Paiements

### 4.1 Migration des services d'abonnements

- [x] **SUBSCRIPTIONS-000** : Migrer les services d'abonnements vers la nouvelle architecture
  - D√©placer `plansAPI` et `subscriptionsAPI` vers `src/services/api/subscriptions/subscriptionsService.ts`
  - Cr√©er les types dans `src/services/api/subscriptions/subscriptionsTypes.ts`
  - Mettre √† jour tous les imports dans les composants :
    - `src/pages/Subscription.tsx`
    - `src/hooks/useSubscriptions.tsx`
    - `src/hooks/useStripe.tsx` (nouveau hook cr√©√©)
  - Tester que toutes les fonctionnalit√©s marchent encore
  - Valider que les types sont correctement export√©s

### 4.2 Plans et abonnements

- [x] **SUBSCRIPTIONS-001** : Impl√©menter l'API de r√©cup√©ration des plans (`GET /api/plans`)

  - Migrer `plansAPI.getAll()` dans `src/services/api/subscriptions/subscriptionsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - R√©cup√©ration depuis la base de donn√©es
  - Tri par prix croissant
  - Mettre √† jour `src/hooks/useSubscriptions.tsx` pour utiliser le nouveau service

- [x] **SUBSCRIPTIONS-002** : Impl√©menter l'API de r√©cup√©ration des abonnements (`GET /api/users/:id/subscriptions`)

  - Migrer `subscriptionsAPI.getByUserId()` dans `src/services/api/subscriptions/subscriptionsService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Historique des abonnements
  - Statut actuel et dates
  - Mettre √† jour `src/hooks/useSubscriptions.tsx` pour utiliser le nouveau service

- [x] **SUBSCRIPTIONS-003** : Impl√©menter l'API de cr√©ation d'abonnement (`POST /api/subscriptions`)

  - Int√©gration avec Stripe via Stripe Checkout
  - Cr√©ation du customer et subscription via `createCheckoutSession()`
  - Abonnements gratuits via `createFreeSubscription()`
  - Mise √† jour du plan utilisateur
  - Mettre √† jour `src/pages/Subscription.tsx` pour utiliser le nouveau service
  - Hook `useStripe` cr√©√© pour g√©rer les op√©rations Stripe

- [x] **SUBSCRIPTIONS-004** : Impl√©menter l'API de modification d'abonnement (`PUT /api/subscriptions/:id`)
  - Changement de plan via `updateSubscription()`
  - Prorata des paiements
  - Mise √† jour des quotas
  - Mettre √† jour `src/pages/Subscription.tsx` pour utiliser le nouveau service
  - Hook `useStripe` g√®re les modifications d'abonnement

### 4.3 Int√©gration Stripe

- [x] **STRIPE-000** : Int√©gration Stripe compl√®te
  - Configuration des cl√©s publiques Stripe (via API backend)
  - Composants de paiement (hook `useStripe`)
  - Gestion des erreurs de paiement
  - Redirection vers Stripe Checkout
  - Portail client Stripe
  - Webhooks Stripe (g√©r√©s c√¥t√© backend)
  - Gestion des √©checs de paiement (g√©r√©s c√¥t√© backend)

---

## üìä Priorit√© 5 - Gestion des Quotas

### 5.1 Migration des services de quotas

- [x] **QUOTAS-000** : Migrer les services de quotas vers la nouvelle architecture
  - Impl√©menter `quotaAPI` dans `src/services/api/quotas/quotasService.ts`
  - Cr√©er les types dans `src/services/api/quotas/quotasTypes.ts`
  - Mettre √† jour tous les imports dans les composants :
    - `src/hooks/useQuotas.tsx`
  - Tester que toutes les fonctionnalit√©s marchent encore
  - Valider que les types sont correctement export√©s

### 5.2 Suivi des quotas

- [x] **QUOTAS-001** : Impl√©menter l'API de r√©cup√©ration des quotas (`GET /api/users/:id/quotas`)

  - Migrer `quotaAPI.getByUserId()` dans `src/services/api/quotas/quotasService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Calcul en temps r√©el des utilisations
  - Comparaison avec les limites du plan
  - Mettre √† jour `src/hooks/useQuotas.tsx` pour utiliser le nouveau service

- [x] **QUOTAS-002** : Impl√©menter la v√©rification des quotas avant actions
  - V√©rification avant cr√©ation de formulaire
  - V√©rification avant soumission
  - V√©rification avant upload de fichier

### 5.3 Notifications de quotas

- [x] **QUOTAS-003** : Impl√©menter les notifications automatiques
  - Notification √† 80% d'utilisation
  - Notification √† 100% d'utilisation
  - Blocage des actions au-del√† des limites

---

## üéõÔ∏è Priorit√© 6 - Tableau de Bord et Statistiques

### 6.1 Migration des services du tableau de bord

- [x] **DASHBOARD-000** : Migrer les services du tableau de bord vers la nouvelle architecture
  - Impl√©menter `dashboardAPI` dans `src/services/api/dashboard/dashboardService.ts`
  - Cr√©er les types dans `src/services/api/dashboard/dashboardTypes.ts`
  - Mettre √† jour tous les imports dans les composants :
    - `src/pages/Dashboard.tsx`
  - Tester que toutes les fonctionnalit√©s marchent encore
  - Valider que les types sont correctement export√©s

### 6.2 Statistiques utilisateur

- [x] **DASHBOARD-001** : Impl√©menter l'API de statistiques (`GET /api/dashboard/stats`)

  - Migrer `dashboardAPI.getStats()` dans `src/services/api/dashboard/dashboardService.ts`
  - Remplacer la logique mock√©e par de vrais appels API
  - Calcul des m√©triques en temps r√©el
  - Agr√©gation des donn√©es utilisateur
  - Mettre √† jour `src/pages/Dashboard.tsx` pour utiliser le nouveau service

- [x] **DASHBOARD-002** : Impl√©menter les graphiques de performance
  - Soumissions par p√©riode
  - Formulaires les plus populaires
  - √âvolution des quotas
